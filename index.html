<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BRC TV GRÁTIS</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://vjs.zencdn.net/8.3.0/video-js.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; overflow: hidden; }
        
        /* Player Customizado */
        .video-js .vjs-big-play-button {
            background-color: rgba(37, 99, 235, 0.9); border: none; border-radius: 50%;
            width: 80px; height: 80px; line-height: 80px; left: 50%; top: 50%;
            transform: translate(-50%, -50%); transition: all 0.3s ease;
        }
        .video-js .vjs-big-play-button:hover { background-color: #1d4ed8; transform: translate(-50%, -50%) scale(1.1); }
        .video-js .vjs-control-bar { background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); }
        .vjs-error-display { display: none; } 

        /* Scrollbars */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #2563eb; }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* UI Elements */
        .channel-item.active {
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.15) 0%, transparent 100%);
            border-left: 4px solid #2563eb;
        }
        
        .tab-btn.active {
            border-bottom: 2px solid #2563eb;
            color: white;
        }
        
        /* Estilo dos Botões de Categoria (Lista) */
        .cat-btn {
            width: 100%;
            text-align: left;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .cat-btn:hover {
            background-color: #1f1f1f;
        }
        .cat-btn.active {
            background-color: #2563eb;
            color: white;
            font-weight: bold;
        }

        /* Layout */
        .app-layout { display: grid; grid-template-columns: 320px 1fr; height: 100vh; width: 100vw; }
        @media (max-width: 1024px) {
            .app-layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
            #sidebar-container { order: 2; height: auto; overflow-y: visible; }
            #player-container { order: 1; position: sticky; top: 0; z-index: 50; height: 40vh; min-height: 250px; }
        }
    </style>
</head>
<body>

    <div class="app-layout">
        
        <aside id="sidebar-container" class="bg-[#111] border-r border-[#222] flex flex-col h-full overflow-hidden">
            
            <div class="p-4 bg-[#111] sticky top-0 z-20 border-b border-[#222] flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center font-bold">B</div>
                    <span class="font-bold text-lg">BRC <span class="text-blue-500">MEDIA</span></span>
                </div>
                <button onclick="toggleAdmin()" class="p-2 text-gray-400 hover:text-white transition" title="Configurações">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="flex border-b border-[#222] bg-[#141414]">
                <button onclick="switchTab('tv')" id="tab-tv" class="tab-btn active flex-1 py-3 text-sm font-medium text-gray-400 hover:text-white transition flex justify-center gap-2">
                    <i data-lucide="tv" class="w-4 h-4"></i> Canais
                </button>
                <button onclick="switchTab('local')" id="tab-local" class="tab-btn flex-1 py-3 text-sm font-medium text-gray-400 hover:text-white transition flex justify-center gap-2">
                    <i data-lucide="folder-open" class="w-4 h-4"></i> Arquivos
                </button>
            </div>

            <div id="view-tv" class="flex-1 flex flex-col overflow-hidden">
                <div class="p-3 bg-[#111]">
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-500"></i>
                        <input id="search-input" type="text" placeholder="Buscar canais..." class="w-full bg-[#1a1a1a] text-sm rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 text-white placeholder-gray-600">
                    </div>
                </div>
                
                <div class="flex flex-1 overflow-hidden">
                    <div class="w-28 bg-[#0a0a0a] flex flex-col gap-1 p-2 border-r border-[#222] overflow-y-auto">
                        <button onclick="filterCategory('Canais')" class="cat-btn text-gray-400 text-xs">Canais</button>
                        <button onclick="filterCategory('Filmes')" class="cat-btn text-gray-400 text-xs">Filmes</button>
                        <button onclick="filterCategory('Esportes')" class="cat-btn text-gray-400 text-xs">Esportes</button>
                        <button onclick="filterCategory('Músicas')" class="cat-btn text-gray-400 text-xs">Músicas</button>
                        <button onclick="filterCategory('Infantil')" class="cat-btn text-gray-400 text-xs">Infantil</button>
                        <button onclick="filterCategory('Notícias')" class="cat-btn text-gray-400 text-xs">Notícias</button>
                    </div>

                    <div id="channel-list" class="flex-1 overflow-y-auto p-2 space-y-1 bg-[#111]"></div>
                </div>
            </div>

            <div id="view-local" class="hidden flex-1 flex flex-col overflow-hidden">
                <div class="p-4 grid grid-cols-2 gap-2 border-b border-[#222]">
                    <button onclick="document.getElementById('file-input').click()" class="bg-[#222] hover:bg-[#333] text-white p-3 rounded-lg flex flex-col items-center text-xs font-bold transition">
                        <i data-lucide="file-video" class="w-6 h-6 mb-1 text-blue-500"></i> Abrir Arquivo
                    </button>
                    <button onclick="document.getElementById('folder-input').click()" class="bg-[#222] hover:bg-[#333] text-white p-3 rounded-lg flex flex-col items-center text-xs font-bold transition">
                        <i data-lucide="folder-search" class="w-6 h-6 mb-1 text-yellow-500"></i> Abrir Pasta
                    </button>
                </div>
                <input type="file" id="file-input" multiple hidden accept="video/,audio/,image/*,.mkv,.avi,.wmv,.mov,.mp4,.mp3,.wav,.ogg,.jpg,.png,.gif">
                <input type="file" id="folder-input" webkitdirectory directory multiple hidden>
                
                <div class="p-2 bg-[#1a1a1a] text-xs text-gray-400 font-bold flex justify-between items-center">
                    <span>PLAYLIST LOCAL</span>
                    <button onclick="clearLocalPlaylist()" class="text-red-400 hover:text-white"><i data-lucide="trash" class="w-3 h-3"></i></button>
                </div>
                <div id="local-list" class="flex-1 overflow-y-auto p-2 space-y-1">
                    <div class="text-center text-gray-500 text-xs mt-10 p-4">
                        Nenhum arquivo selecionado.<br>Abra um arquivo ou pasta para reproduzir.
                    </div>
                </div>
            </div>
        </aside>

        <main id="player-container" class="bg-black relative flex flex-col justify-center group">
            <div class="relative w-full h-full bg-black flex items-center justify-center overflow-hidden">
                
                <video id="main-player" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" crossorigin="anonymous" poster="https://via.placeholder.com/1920x1080/111111/333333?text=BRC+MEDIA+CENTER"></video>
                
                <img id="image-viewer" class="hidden w-full h-full object-contain absolute inset-0 bg-black z-40" alt="Visualizador">
                
                <iframe id="iframe-player" class="absolute inset-0 w-full h-full hidden border-0 z-30" allow="autoplay; fullscreen"></iframe>

                <div id="error-overlay" class="absolute inset-0 bg-black/90 hidden z-50 flex flex-col items-center justify-center text-center p-6">
                    <i data-lucide="alert-triangle" class="w-12 h-12 text-yellow-500 mb-4"></i>
                    <h3 class="text-xl font-bold text-white">Erro de Reprodução</h3>
                    <p class="text-gray-400 text-sm mt-2 max-w-md">Formato não suportado pelo navegador ou arquivo corrompido.</p>
                    <button onclick="playNextLocal()" class="mt-4 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700 text-sm font-bold">Tentar Próximo</button>
                </div>
            </div>

            <div class="absolute top-0 left-0 w-full p-4 bg-gradient-to-b from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none z-10">
                <h2 id="now-playing-title" class="text-xl font-bold text-white drop-shadow-lg">Selecione um conteúdo</h2>
                <p id="now-playing-meta" class="text-xs text-blue-400 font-bold uppercase tracking-wider">Media Center</p>
            </div>
            
            <div id="local-controls" class="hidden absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-black/80 px-4 py-2 rounded-full gap-4 z-20 border border-gray-700">
                <button onclick="playPrevLocal()" class="text-white hover:text-blue-400"><i data-lucide="skip-back"></i></button>
                <button onclick="playNextLocal()" class="text-white hover:text-blue-400"><i data-lucide="skip-forward"></i></button>
            </div>
        </main>
    </div>

    <div id="admin-modal" class="fixed inset-0 bg-black/90 z-[100] hidden flex-col items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-[#1a1a1a] w-full max-w-md rounded-xl border border-[#333] shadow-2xl flex flex-col max-h-[85vh] overflow-hidden">
            <div class="p-4 border-b border-[#333] flex justify-between items-center bg-[#202020]">
                <h3 class="font-bold text-white flex items-center gap-2"><i data-lucide="settings-2" class="w-4 h-4"></i> Configurações</h3>
                <button onclick="toggleAdmin()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="login-view" class="p-8 flex flex-col items-center">
                <input type="password" id="admin-pass" placeholder="Senha" class="w-full bg-[#0f0f0f] border border-[#333] text-white p-3 rounded mb-4 text-center">
                <button onclick="verifyLogin()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded font-bold">Entrar</button>
            </div>
            <div id="panel-view" class="hidden flex-1 flex-col overflow-hidden">
                <div class="p-4 bg-[#111] border-b border-[#333] grid gap-2">
                    <input id="new-name" placeholder="Nome" class="bg-[#222] text-white p-2 rounded text-sm">
                    <div class="flex gap-2">
                        <select id="new-cat" class="bg-[#222] text-white p-2 rounded text-sm w-1/3"><option>Canais</option><option>Filmes</option><option>Esportes</option></select>
                        <input id="new-url" placeholder="URL" class="bg-[#222] text-white p-2 rounded text-sm flex-1">
                    </div>
                    <button onclick="addChannel()" class="bg-green-600 hover:bg-green-500 text-white p-2 rounded text-sm font-bold mt-1">Adicionar</button>
                </div>
                <ul id="admin-list" class="flex-1 overflow-y-auto p-2 space-y-1"></ul>
                <div class="p-3 border-t border-[#333] bg-[#202020] flex justify-between text-xs">
                    <button onclick="resetFactory()" class="text-red-400">Resetar</button>
                    <button onclick="exportData()" class="text-blue-400">Backup</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://vjs.zencdn.net/8.3.0/video.min.js"></script>
    <script>
        // --- CONFIGURAÇÃO ---
        const ADMIN_PASSWORD = "08242979";
        const STORAGE_KEY = "brc_tv_v3_media";
        
        // Correção da Lista de Canais (Adicionei a vírgula e corrigi as categorias)
        const DEFAULT_CHANNELS = [
            { name: "Tears of Steel (4K)", category: "Filmes", url: "https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8" },
            { name: "Big Buck Bunny", category: "Filmes", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" },
            { name: "DarkFlix HD", category: "Filmes", url: "https://video01.soultv.com.br/darkflix/darkflix/playlist.m3u8" },
            { name: "SBT", category: "Canais", url: "https://youtu.be/ABVQXgr2LW4" },
            { name: "+SBT", category: "Canais", url: "https://mais.sbt.com.br/" },
            { name: "BAND", category: "Canais", url: "https://www.band.com.br/ao-vivo" },
            { name: "REDE TV", category: "Canais", url: "https://geo.dailymotion.com/player/xgrus.html?video=kYe5OYErhldJ75Azib2" },
            { name: "REDE TV 2", category: "Canais", url: " https://tv02.zas.media:1936/redetvparana/redetvparana/playlist.m3u8"},
            { name: "RECORD", category: "Canais", url: "https://www.youtube.com/watch?v=wB3K_ESTQrA" },
            { name: "TV CULTURA", category: "Canais", url: "https://cultura.uol.com.br/aovivo/" },
            { name: "TNT", category: "Canais", url: "https://cdn-1.nxplay.com.br/TNT_TK/index.m3u8" },
            { name: "RECORD NEWS", category: "Notícias", url: "https://video02.logicahost.com.br/tvguara23/tvguara23/chunklist_w488754077.m3u8" },
            { name: "GEEKDOT", category: "Canais", url: "https://stream.ichibantv.com:3764/hybrid/play.m3u8" },
            { name: "POOP TV", category:  "Músicas", url: "https://stream.ichibantv.com:3522/hybrid/play.m3u8" },
            { name: "JETSONS", category: "Infantil", url: "https://stmv1.srvif.com/jetsontv/jetsontv/playlist.m3u8" },
            { name: "TV BRASIL", category: "Canais", url: "https://tvbrasil-stream.ebc.com.br/index.m3u8" },
            { name: "CANAL EDUCAÇÃO", category: "Canais", url: "https://canaleducacao-stream.ebc.com.br/index.m3u8" },
            { name: "REDE BRASIL", category: "Canais", url: "https://video01.logicahost.com.br/redebrasil02/redebrasil02/playlist.m3u8" },
            { name: "Cultura (PR)", category: "Canais", url: "https://youtu.be/ABVQXgr2LW4" },
            { name: "RETRO TV", category: "Canais", url: "https://acesso.ecast.site:3070/live/awtvlive.m3u8" },
            { name: "Vintage TV", category: "Canais", url: "https://video01.kshost.com.br:4443/rogerio7271/rogerio7271/playlist.m3u8" },
            { name: "KroneHIT", category:  "Músicas", url: "https://bitcdn-kronehit.bitmovin.com/v2/hls/playlist.m3u8" },
            { name: "TV MAX", category: "Músicas", url: "https://5cf4a2c2512a2.streamlock.net/tvmax/tvmax/playlist.m3u8" },
            { name: "TV Séries", category: "Canais", url: "https://stmv1.srvif.com/tvserie/tvserie/playlist.m3u8" },
            { name: "TV CLUBE", category: "Canais", url: "https://5c483b9d1019c.streamlock.net/8186/8186/playlist.m3u8" },
            { name: "1onemus", category: "Músicas", url: "http://hz1.teleport.cc/HLS/HD.m3u8" },
            { name: "MAIS UM", category: "Músicas", url: "https://stream.ichibantv.com:3230/hybrid/play.m3u8" },
            { name: "Rock TV", category: "Músicas", url: "https://tv.broadcasting.ro/rocktv/85c83a80-4f71-4f2d-a8d6-43f676896bcb.m3u8" },
            { name:"Record News", category:"Notícias", url:"https://playplus-lh.akamaihd.net/i/pp_f_recordnews_l@422136/index_1_av-b.m3u8"},
            { name:"Red Bull TV", category:"Esportes", url:"https://rbmn-live.akamaized.net/hls/live/590964/BoRB-AT/master.m3u8"},
            { name:"NASA TV", category:"Canais", url:"https://ntv1.akamaized.net/hls/live/2014075/NASA-NTV1-HLS/master.m3u8"},
            { name:"Fashion TV", category:"Canais", url:"https://fash1043.cloudycdn.services/slive/_definst_/ftv_paris_adaptive.smil/playlist.m3u8"},
            { name:"Filme Teste", category:"Filmes", url:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"},
            { name:"Combate", category:"Esportes", url:"http://95.141.32.213:8081/look/combatel/playlist.m3u8"},
            { name:"Disney XD", category:"Infantil", url:"http://tv.ec.cx:1935/redecanais-stream-disneyxd/myStream/chunklist_w1378600076.m3u8"},
            { name:"NICK JR", category:"Infantil", url:"http://tv.ec.cx:1935/redecanais-stream-nick/myStream/chunklist_w1116862459.m3u8"},
            { name:"RETRO CARTOON", category:"Infantil", url:"http://stmv2.srvstm.com/cartoonr/cartoonr/playlist.m3u8"},
            { name:"ANIME TV", category:"Infantil", url:"http://video7.stream.mx:1935/raxatv/raxatv/chunklist_w884577146.m3u8"},
            { name:"Telecine Action", category:"Filmes", url:"http://live-s101.abweb.com/liveabs101/ngrp:action.stream_bis/chunklist_f1tv_b1096000.m3u8"}
        ];
    
        // Estado
        let webChannels = JSON.parse(localStorage.getItem(STORAGE_KEY)) || DEFAULT_CHANNELS;
        let localFiles = [];
        let currentWebIndex = -1;
        let currentLocalIndex = -1;
        let player = null;
        let activeTab = 'tv';
        let imageTimer = null;
        let activeCategory = 'Canais'; // Categoria padrão

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            initPlayer();
            lucide.createIcons();
            
            // Iniciar na categoria Canais
            filterCategory('Canais');
            
            // Event Listeners Arquivos
            document.getElementById('file-input').addEventListener('change', handleFileSelect);
            document.getElementById('folder-input').addEventListener('change', handleFileSelect);
            document.getElementById('search-input').addEventListener('input', (e) => {
                if(e.target.value.trim() === "") {
                    filterCategory(activeCategory);
                } else {
                    renderWebList(webChannels.filter(c => c.name.toLowerCase().includes(e.target.value.toLowerCase())));
                }
            });
            
            if ('serviceWorker' in navigator && window.location.protocol.startsWith('http')) {
                navigator.serviceWorker.register('sw.js').catch(console.error);
            }
        });

        function initPlayer() {
            player = videojs('main-player', {
                fluid: true, responsive: true, controls: true, autoplay: false,
                html5: { hls: { overrideNative: true } }
            });
            
            player.on('ended', () => {
                if (activeTab === 'local' && currentLocalIndex < localFiles.length - 1) {
                    playNextLocal();
                }
            });

            player.on('error', () => {
                if(activeTab === 'local') document.getElementById('error-overlay').classList.remove('hidden');
            });
        }

        // --- NAVEGAÇÃO DE ABAS ---
        function switchTab(tab) {
            activeTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab-${tab}).classList.add('active');
            
            document.getElementById('view-tv').classList.toggle('hidden', tab !== 'tv');
            document.getElementById('view-local').classList.toggle('hidden', tab !== 'local');
            
            if(tab === 'local' && localFiles.length > 0) {
                document.getElementById('local-controls').classList.remove('hidden');
            } else {
                document.getElementById('local-controls').classList.add('hidden');
            }
        }

        // --- LÓGICA ARQUIVOS LOCAIS ---
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            if (!files.length) return;

            // Filtrar extensões suportadas
            const allowedExts = ['.mp4', '.mkv', '.avi', '.mov', '.wmv', '.mpg', '.mpeg', '.m4v', '.webm', '.mp3', '.wav', '.ogg', '.wma', '.jpg', '.png', '.gif', '.webp', '.jpeg'];
            
            const newFiles = files.filter(f => {
                const name = f.name.toLowerCase();
                return allowedExts.some(ext => name.endsWith(ext));
            }).sort((a, b) => a.name.localeCompare(b.name)); 

            if (newFiles.length > 0) {
                localFiles = newFiles;
                renderLocalList();
                playLocalFile(0); 
                switchTab('local');
            } else {
                alert('Nenhum arquivo de mídia compatível encontrado.');
            }
            e.target.value = ''; 
        }

        function renderLocalList() {
            const list = document.getElementById('local-list');
            list.innerHTML = '';
            localFiles.forEach((f, i) => {
                const div = document.createElement('div');
                div.className = channel-item flex items-center p-2 cursor-pointer border-b border-[#222] hover:bg-[#1f1f1f] ${i === currentLocalIndex ? 'active' : ''};
                div.onclick = () => playLocalFile(i);
                
                let icon = 'file';
                if(f.type.startsWith('video')) icon = 'film';
                else if(f.type.startsWith('audio')) icon = 'music';
                else if(f.type.startsWith('image')) icon = 'image';

                div.innerHTML = `
                    <i data-lucide="${icon}" class="w-4 h-4 text-gray-500 mr-2"></i>
                    <span class="text-sm truncate text-gray-300 flex-1">${f.name}</span>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
            document.getElementById('local-controls').classList.remove('hidden');
        }

        function playLocalFile(index) {
            if(index < 0 || index >= localFiles.length) return;
            currentLocalIndex = index;
            const file = localFiles[index];
            const url = URL.createObjectURL(file);
            const type = file.type;
            const name = file.name.toLowerCase();

            renderLocalList(); 
            document.getElementById('now-playing-title').innerText = file.name;
            document.getElementById('now-playing-meta').innerText = "Reproduzindo Local";
            document.getElementById('error-overlay').classList.add('hidden');

            const vid = document.querySelector('.video-js');
            const imgView = document.getElementById('image-viewer');
            const iframe = document.getElementById('iframe-player');
            
            vid.classList.add('hidden');
            imgView.classList.add('hidden');
            iframe.classList.add('hidden');
            player.pause();
            clearTimeout(imageTimer);

            if (type.startsWith('image') || name.match(/\.(jpg|jpeg|png|gif|webp)$/)) {
                imgView.src = url;
                imgView.classList.remove('hidden');
                imageTimer = setTimeout(playNextLocal, 5000);
            } else {
                vid.classList.remove('hidden');
                player.src({ src: url, type: type || getMimeFromExt(name) });
                player.play().catch(e => console.log("Autoplay falhou", e));
            }
        }

        function getMimeFromExt(name) {
            if(name.endsWith('.mkv')) return 'video/x-matroska';
            if(name.endsWith('.avi')) return 'video/x-msvideo';
            if(name.endsWith('.wmv')) return 'video/x-ms-wmv';
            if(name.endsWith('.mov')) return 'video/quicktime';
            return '';
        }

        function playNextLocal() { playLocalFile(currentLocalIndex + 1); }
        function playPrevLocal() { playLocalFile(currentLocalIndex - 1); }
        function clearLocalPlaylist() { localFiles = []; renderLocalList(); document.getElementById('local-controls').classList.add('hidden'); }

        // --- LÓGICA TV ONLINE (WEB) ---
        
        // Função genérica de renderização
        function renderWebList(listToRender) {
            const list = document.getElementById('channel-list');
            list.innerHTML = '';
            
            if(listToRender.length === 0) {
                list.innerHTML = '<div class="p-4 text-gray-500 text-xs text-center">Nenhum canal nesta categoria.</div>';
                return;
            }

            listToRender.forEach((c) => {
                // Encontrar índice original no array principal para reprodução
                const originalIndex = webChannels.indexOf(c);
                
                const div = document.createElement('div');
                div.className = 'channel-item flex items-center p-3 cursor-pointer border-b border-[#1a1a1a] hover:bg-[#1f1f1f] group';
                div.onclick = () => loadWebChannel(originalIndex);
                div.innerHTML = `
                    <div class="w-8 h-8 rounded bg-[#222] flex items-center justify-center mr-3 text-xs font-bold text-gray-500">${c.name.substring(0,2).toUpperCase()}</div>
                    <div class="flex-1 min-w-0">
                        <h4 class="text-sm font-semibold text-gray-200 truncate">${c.name}</h4>
                        <p class="text-[10px] text-gray-500">${c.category}</p>
                    </div>
                    <i data-lucide="play" class="w-3 h-3 text-blue-500 opacity-0 group-hover:opacity-100"></i>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        function loadWebChannel(index) {
            if(index === -1) return;
            const ch = webChannels[index];
            currentWebIndex = index;
            
            document.getElementById('image-viewer').classList.add('hidden');
            document.getElementById('local-controls').classList.add('hidden');
            
            document.getElementById('now-playing-title').innerText = ch.name;
            document.getElementById('now-playing-meta').innerText = ch.category;

            const vid = document.querySelector('.video-js');
            const iframe = document.getElementById('iframe-player');
            
            const isStream = ch.url.match(/\.(m3u8|mp4)$/i);
            
            if (isStream) {
                iframe.classList.add('hidden');
                vid.classList.remove('hidden');
                player.src({ src: ch.url, type: ch.url.endsWith('.m3u8') ? 'application/x-mpegURL' : 'video/mp4' });
                player.play().catch(()=>{});
            } else {
                player.pause();
                vid.classList.add('hidden');
                iframe.classList.remove('hidden');
                iframe.src = ch.url;
            }
            if(window.innerWidth < 1024) window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Filtrar e atualizar a lista
        function filterCategory(cat) {
            activeCategory = cat;
            const filtered = webChannels.filter(c => c.category === cat);
            
            renderWebList(filtered);

            // Atualizar UI dos botões de categoria
            document.querySelectorAll('.cat-btn').forEach(b => {
                if(b.innerText === cat) {
                    b.classList.add('active');
                    b.classList.remove('text-gray-400');
                } else {
                    b.classList.remove('active');
                    b.classList.add('text-gray-400');
                }
            });
        }

        // --- ADMIN FUNCS ---
        function toggleAdmin() {
            const m = document.getElementById('admin-modal');
            m.classList.toggle('hidden'); m.classList.toggle('flex');
            if(!m.classList.contains('hidden')) {
                 document.getElementById('login-view').classList.remove('hidden');
                 document.getElementById('panel-view').classList.add('hidden');
                 lucide.createIcons();
            }
        }
        function verifyLogin() {
            if(document.getElementById('admin-pass').value === ADMIN_PASSWORD) {
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('panel-view').classList.remove('hidden');
                renderAdminList();
            }
        }
        function renderAdminList() {
            const ul = document.getElementById('admin-list'); ul.innerHTML = '';
            webChannels.forEach((c,i) => {
                const li = document.createElement('li');
                li.className = 'bg-[#222] p-2 rounded flex justify-between text-xs items-center';
                li.innerHTML = <span>${c.name}</span><button onclick="delChannel(${i})" class="text-red-500 font-bold">X</button>;
                ul.appendChild(li);
            });
        }
        function addChannel() {
            const n = document.getElementById('new-name').value;
            const u = document.getElementById('new-url').value;
            const c = document.getElementById('new-cat').value;
            if(n && u) { 
                webChannels.push({name:n, category:c, url:u}); 
                localStorage.setItem(STORAGE_KEY, JSON.stringify(webChannels)); 
                renderAdminList(); 
                filterCategory(activeCategory); 
            }
        }
        function delChannel(i) { 
            webChannels.splice(i,1); 
            localStorage.setItem(STORAGE_KEY, JSON.stringify(webChannels)); 
            renderAdminList(); 
            filterCategory(activeCategory); 
        }
        function resetFactory() { 
            webChannels=[...DEFAULT_CHANNELS]; 
            localStorage.setItem(STORAGE_KEY, JSON.stringify(webChannels)); 
            renderAdminList(); 
            filterCategory(activeCategory); 
        }
        function exportData() {
            const a = document.createElement('a');
            a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(webChannels));
            a.download = "backup.json"; a.click();
        }
  // --- FUNÇÕES DO SISTEMA (CONTINUAÇÃO) ---

        // 1. Alternar Visibilidade do Admin
        function toggleAdmin() {
            const modal = document.getElementById('admin-modal');
            const loginView = document.getElementById('login-view');
            const panelView = document.getElementById('panel-view');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                // Reseta para view de login
                loginView.classList.remove('hidden');
                panelView.classList.add('hidden');
                document.getElementById('admin-pass').value = '';
            } else {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }

        // 2. Verificar Senha
        function verifyLogin() {
            const pass = document.getElementById('admin-pass').value;
            if (pass === ADMIN_PASSWORD) {
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('panel-view').classList.remove('hidden');
                document.getElementById('panel-view').classList.add('flex');
                renderAdminList(); // Carrega a lista para edição
            } else {
                alert('Senha incorreta!');
            }
        }

        // 3. ADICIONAR CANAL (A correção principal)
        function addChannel() {
            const nameInput = document.getElementById('new-name');
            const catInput = document.getElementById('new-cat');
            const urlInput = document.getElementById('new-url');

            const name = nameInput.value.trim();
            const category = catInput.value;
            const url = urlInput.value.trim();

            if (!name || !url) {
                alert("Por favor, preencha o Nome e a URL.");
                return;
            }

            // Cria o objeto do novo canal
            const newChannel = { name, category, url };

            // Adiciona ao array principal
            webChannels.push(newChannel);

            // SALVA NO NAVEGADOR (Essencial para não perder ao atualizar)
            localStorage.setItem(STORAGE_KEY, JSON.stringify(webChannels));

            // Limpa os campos
            nameInput.value = '';
            urlInput.value = '';

            // Atualiza as listas visuais
            renderAdminList();
            
            // Se a categoria atual for a mesma do novo canal, atualiza a lista principal
            if (activeCategory === category || activeCategory === 'Canais') {
                filterCategory(activeCategory); 
            }

            alert("Canal adicionado com sucesso!");
        }

        // 4. Renderizar Lista no Admin (Com opção de deletar)
        function renderAdminList() {
            const list = document.getElementById('admin-list');
            list.innerHTML = '';

            webChannels.forEach((channel, index) => {
                const item = document.createElement('div');
                item.className = "flex justify-between items-center bg-[#222] p-2 rounded text-sm border border-[#333]";
                item.innerHTML = `
                    <span class="truncate flex-1 text-gray-300">${index + 1}. ${channel.name} <span class="text-[10px] text-blue-400 ml-2 border border-blue-900 px-1 rounded">${channel.category}</span></span>
                    <button onclick="deleteChannel(${index})" class="text-red-500 hover:text-red-400 ml-2 p-1"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                `;
                list.appendChild(item);
            });
            lucide.createIcons();
        }

        // 5. Deletar Canal
        function deleteChannel(index) {
            if(confirm("Tem certeza que deseja excluir este canal?")) {
                webChannels.splice(index, 1);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(webChannels));
                renderAdminList();
                filterCategory(activeCategory);
            }
        }

        // 6. Resetar de Fábrica
        function resetFactory() {
            if(confirm("Isso apagará todos os canais adicionados e restaurará a lista original. Continuar?")) {
                localStorage.removeItem(STORAGE_KEY);
                webChannels = [...DEFAULT_CHANNELS]; // Restaura padrão
                localStorage.setItem(STORAGE_KEY, JSON.stringify(webChannels));
                renderAdminList();
                filterCategory('Canais');
                alert("Restaurado com sucesso!");
            }
        }

        // 7. Renderizar Lista Principal (Player)
        function filterCategory(category) {
            activeCategory = category;
            
            // Atualiza visual dos botões de categoria
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if(btn.textContent === category) btn.classList.add('active');
                else btn.classList.remove('active');
            });

            // Filtra os canais
            const filtered = webChannels.filter(ch => ch.category === category);
            renderWebList(filtered);
        }

        function renderWebList(listToRender) {
            const container = document.getElementById('channel-list');
            container.innerHTML = '';

            if(listToRender.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-xs p-4 text-center">Nenhum conteúdo nesta categoria.</div>';
                return;
            }

            listToRender.forEach((channel) => {
                // Encontra o índice original no array principal para tocar o correto
                const originalIndex = webChannels.indexOf(channel);
                
                const div = document.createElement('div');
                div.className = channel-item p-3 rounded-lg cursor-pointer hover:bg-[#1f1f1f] transition flex items-center gap-3 ${currentWebIndex === originalIndex ? 'active' : ''};
                div.onclick = () => loadChannel(originalIndex);

                div.innerHTML = `
                    <div class="w-8 h-8 bg-[#222] rounded-full flex items-center justify-center text-gray-400 font-bold text-xs border border-[#333]">
                        ${channel.name.substring(0,2).toUpperCase()}
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="text-sm font-medium text-white truncate">${channel.name}</h4>
                        <p class="text-[10px] text-gray-500 uppercase">${channel.category}</p>
                    </div>
                    ${currentWebIndex === originalIndex ? '<i data-lucide="bar-chart-2" class="w-4 h-4 text-blue-500 animate-pulse"></i>' : ''}
                `;
                container.appendChild(div);
            });
            lucide.createIcons();
        }

        // 8. Carregar e Tocar Canal
        function loadChannel(index) {
            currentWebIndex = index;
            const channel = webChannels[index];
            
            // Atualiza UI da lista
            filterCategory(activeCategory); 

            // Atualiza Título
            document.getElementById('now-playing-title').textContent = channel.name;
            document.getElementById('now-playing-meta').textContent = AO VIVO • ${channel.category};

            // Lógica de Player (HLS vs YouTube vs MP4)
            const url = channel.url;
            const isYoutube = url.includes('youtu');
            const isIframe = !url.endsWith('.m3u8') && !url.endsWith('.mp4') && !isYoutube;

            // Esconde tudo primeiro
            document.getElementById('image-viewer').classList.add('hidden');
            document.getElementById('error-overlay').classList.add('hidden');
            
            const videoEl = document.querySelector('.video-js');
            const iframeEl = document.getElementById('iframe-player');

            if (isYoutube || isIframe) {
                player.pause();
                videoEl.classList.add('hidden');
                iframeEl.classList.remove('hidden');
                
                // Tratamento básico para embed de YouTube
                let embedUrl = url;
                if(isYoutube) {
                    if(url.includes('watch?v=')) embedUrl = url.replace('watch?v=', 'embed/');
                    else if(url.includes('youtu.be/')) embedUrl = url.replace('youtu.be/', 'www.youtube.com/embed/');
                    embedUrl += "?autoplay=1";
                }
                iframeEl.src = embedUrl;
            } else {
                iframeEl.classList.add('hidden');
                iframeEl.src = ''; // Para o áudio do iframe
                videoEl.classList.remove('hidden');
                
                player.src({ type: url.endsWith('.m3u8') ? 'application/x-mpegURL' : 'video/mp4', src: url });
                player.play().catch(e => console.log("Autoplay bloqueado pelo navegador"));
            }
        }

        // 9. Gerenciamento de Abas (TV vs Local)
        function switchTab(tab) {
            activeTab = tab;
            if (tab === 'tv') {
                document.getElementById('view-tv').classList.remove('hidden');
                document.getElementById('view-local').classList.add('hidden');
                document.getElementById('tab-tv').classList.add('active');
                document.getElementById('tab-local').classList.remove('active');
                document.getElementById('local-controls').classList.add('hidden');
            } else {
                document.getElementById('view-tv').classList.add('hidden');
                document.getElementById('view-local').classList.remove('hidden');
                document.getElementById('tab-tv').classList.remove('active');
                document.getElementById('tab-local').classList.add('active');
                if(localFiles.length > 0) document.getElementById('local-controls').classList.remove('hidden');
            }
        }

        // Funções auxiliares (placeholder para o código local que não foi o foco, mas evita erros)
        function handleFileSelect(e) { /* Lógica de arquivo local */ }
        function playNextLocal() { /* Lógica próximo arquivo local */ }
        function playPrevLocal() { /* Lógica arquivo anterior local */ }
        function clearLocalPlaylist() { /* Limpar playlist */ }
        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(webChannels));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "canais_backup.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

    </script>
</body>
</html>
